#!/usr/bin/env ruby

require 'rubygems'
require 'squarepusher'

def error_msg(msg)
  $stderr.puts "ERROR - #{msg}"
end

def fail(msg, code=1)
  error_msg(msg)
  exit code
end

options = { :size => :original }
OptionParser.new do |opts|
  opts.banner = "USAGE: squarepusher [options] <api-key> <api-secret> <token> <output_dir>"

  opts.on("-s", "--size SIZE", "secret") do |v|
    options[:size] = v.to_sym
  end
    
  opts.parse!(ARGV)
  
  if ARGV.size != 4
    $stderr.puts opts
    exit 1
  end
end

key, secret, token, output_dir = ARGV

client = Squarepusher::Client.new(key, secret, token, options)

client.each_photoset do |pset|
  puts pset.inspect
  client.download_photoset(pset, output_dir)
end